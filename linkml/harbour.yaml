id: https://w3id.org/reachhaven/harbour/credentials/v1
name: harbour
description: >
  Base LinkML schema for Harbour credentials.
  Defines the W3C VC envelope constraints (issuer, validFrom,
  credentialStatus), evidence types, revocation (CRSet), DID document
  structure, and trust anchor services. Domain-specific participant
  and credential types are defined in separate domain schemas
  (e.g. gaiax-domain.yaml).

prefixes:
  linkml: https://w3id.org/linkml/
  harbour: https://w3id.org/reachhaven/harbour/credentials/v1/
  core: https://w3id.org/reachhaven/harbour/core/v1/
  xsd: http://www.w3.org/2001/XMLSchema#
  cs: https://www.w3.org/ns/credentials/status#
  cred: https://www.w3.org/2018/credentials#
  schema: http://schema.org/

default_prefix: harbour
default_range: string

imports:
  - linkml:types
  - ./core

slots:
  # --- DID Slots ---
  controller:
    slot_uri: https://www.w3.org/ns/did#controller
    range: string

  serviceEndpoint:
    slot_uri: https://www.w3.org/ns/did#serviceEndpoint
    range: Any
    required: true

  # --- Revocation Registry (CRSet) Slots ---
  statusPurpose:
    slot_uri: cs:statusPurpose
    range: string
    required: false

  registryEndpoint:
    description: Service endpoint IRI for the CRSet.
    slot_uri: harbour:registryEndpoint
    range: uri
    required: false

  contractURN:
    slot_uri: harbour:contractURN
    range: uri
    required: false

  sourceRepository:
    slot_uri: harbour:sourceRepository
    range: uri
    required: false

  implementation:
    slot_uri: harbour:implementation
    range: uri
    required: false

  # --- Trust Anchor / Organization Slots ---
  contactType:
    slot_uri: schema:contactType
    range: string

  name:
    description: A human-readable name for the entity.
    slot_uri: schema:name
    range: string

  description:
    description: A human-readable description of the entity.
    slot_uri: schema:description
    range: string

  url:
    description: A URL associated with the entity.
    slot_uri: schema:url
    range: uri

  email:
    description: An email address.
    slot_uri: schema:email
    range: string

  contactPoint:
    description: A contact point for the entity.
    slot_uri: schema:contactPoint
    range: string

  # --- Credential / Evidence Slots ---
  evidence:
    slot_uri: cred:evidence
    range: Evidence
    multivalued: true
    required: false

  verifiablePresentation:
    description: >
      A Verifiable Presentation embedded as evidence. In examples this is
      shown as expanded JSON-LD for readability; on the wire it is encoded
      as a VC-JOSE-COSE compact JWS string (typ: vp+ld+jwt).
    slot_uri: harbour:verifiablePresentation
    range: Any
    required: false

  vp:
    description: >
      DEPRECATED: Use verifiablePresentation instead.
      A Verifiable Presentation embedded as evidence (nested JSON-LD object).
    slot_uri: harbour:vp
    range: Any
    required: false

  # --- Credential Envelope Slots ---
  issuer:
    slot_uri: cred:issuer
    range: string
    required: true
    description: DID of the credential issuer.

  # --- W3C VC v2 Envelope Slots (harbour constrains these) ---
  validFrom:
    slot_uri: cred:validFrom
    range: datetime
    required: true

  validUntil:
    slot_uri: cred:validUntil
    range: datetime
    required: false

classes:
  Any:
    class_uri: linkml:Any
    description: "Generic class for any type of value."

  # ==========================================
  # 1. ROOT DOCUMENT
  # ==========================================
  DIDDocument:
    class_uri: https://www.w3.org/ns/did#DIDDocument
    slots:
      - id
      - controller
    attributes:
      service:
        slot_uri: https://www.w3.org/ns/did#service
        multivalued: true
        inlined: true
        range: ServiceUnion
      verificationMethod:
        slot_uri: https://www.w3.org/ns/did#verificationMethod
        multivalued: true
        range: VerificationMethod

  # ==========================================
  # 2. SERVICES
  # ==========================================
  ServiceUnion:
    union_of:
      - TrustAnchorService
      - CRSetRevocationRegistryService

  TrustAnchorService:
    class_uri: harbour:TrustAnchorService
    slots:
      - id
      - type
      - serviceEndpoint
    slot_usage:
      serviceEndpoint:
        range: OrganizationEndpoint
        inlined: true

  OrganizationEndpoint:
    class_uri: schema:Organization
    slots:
      - name
      - url
      - description
      - contactPoint
    slot_usage:
      contactPoint:
        range: ContactPoint
        inlined: true

  ContactPoint:
    class_uri: schema:ContactPoint
    slots:
      - contactType
      - email

  CRSetRevocationRegistryService:
    class_uri: harbour:CRSetRevocationRegistryService
    slots:
      - id
      - type
      - serviceEndpoint
    slot_usage:
      serviceEndpoint:
        range: CRSetServiceEndpoint
        inlined: true

  CRSetServiceEndpoint:
    class_uri: harbour:CRSetServiceEndpoint
    slots:
      - registryEndpoint
      - statusPurpose
      - contractURN
      - sourceRepository
      - implementation

  # ==========================================
  # 3. CREDENTIAL TYPES
  # ==========================================
  # Harbour credential types add mandatory credentialStatus (CRSetEntry)
  # and optional evidence to W3C VerifiableCredential.

  HarbourCredential:
    abstract: true
    description: >
      Abstract base for all Harbour credentials. Requires issuer, validFrom,
      and credentialStatus with at least one CRSetEntry for revocation support.
    class_uri: harbour:HarbourCredential
    slots:
      - id
      - type
      - issuer
      - validFrom
      - validUntil
      - evidence
    attributes:
      credentialStatus:
        slot_uri: cred:credentialStatus
        range: CRSetEntry
        multivalued: true
        required: true
        description: Status entries for revocation checking (CRSet).

  # ==========================================
  # 4. EVIDENCE TYPES
  # ==========================================
  Evidence:
    abstract: true
    class_uri: cred:Evidence
    slots:
      - type

  EmailVerification:
    is_a: Evidence
    description: Evidence that an email address was verified (e.g. via Altme EmailPass).
    class_uri: harbour:EmailVerification
    slots:
      - verifiablePresentation
    slot_usage:
      verifiablePresentation:
        required: true

  IssuanceEvidence:
    is_a: Evidence
    description: Evidence referencing a previously issued credential.
    class_uri: harbour:IssuanceEvidence
    slots:
      - verifiablePresentation
    slot_usage:
      verifiablePresentation:
        required: true

  CRSetEntry:
    class_uri: harbour:CRSetEntry
    slots:
      - id
      - type
      - statusPurpose

  # ==========================================
  # 5. HELPERS
  # ==========================================
  VerificationMethod:
    class_uri: https://www.w3.org/ns/did#VerificationMethod
    slots:
      - id
      - type
      - controller
    attributes:
      blockchainAccountId:
        slot_uri: harbour:blockchainAccountId
        range: string
